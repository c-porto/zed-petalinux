From b9ff963c0d314a947ba0c89213ab9b0b09e06b2e Mon Sep 17 00:00:00 2001
From: Carlos Augusto Porto Freitas <carlos.portof@hotmail.com>
Date: Tue, 9 Sep 2025 23:56:47 -0300
Subject: [PATCH] Add address selection from command line

---
 examples/csp_server_client.c | 12 +++---------
 1 file changed, 3 insertions(+), 9 deletions(-)

diff --git a/examples/csp_server_client.c b/examples/csp_server_client.c
index 5db0928d..5ea7ed1b 100644
--- a/examples/csp_server_client.c
+++ b/examples/csp_server_client.c
@@ -19,6 +19,7 @@ int client_start(void);
 
 /* Commandline options */
 static uint8_t server_address = 255;
+static uint8_t address = 24;
 
 /* test mode, used for verifying that host & client can exchange packets over the loopback interface */
 static bool test_mode = false;
@@ -92,12 +93,6 @@ void client(void) {
 		csp_print("Ping address: %u, result %d [mS]\n", server_address, result);
         (void) result;
 
-		/* Send reboot request to server, the server has no actual implementation of csp_sys_reboot() and fails to reboot */
-		csp_reboot(server_address);
-		csp_print("reboot system request sent to address: %u\n", server_address);
-
-		/* Send data packet (string) to server */
-
 		/* 1. Connect to host on 'server_address', port MY_SERVER_PORT with regular UDP-like protocol and 1000 ms timeout */
 		csp_conn_t * conn = csp_connect(CSP_PRIO_NORM, server_address, MY_SERVER_PORT, 1000, CSP_O_NONE);
 		if (conn == NULL) {
@@ -137,7 +132,6 @@ void client(void) {
 /* main - initialization of CSP and start of server/client tasks */
 int main(int argc, char * argv[]) {
 
-    uint8_t address = 0;
 #if (CSP_HAVE_LIBSOCKETCAN)
     const char * can_device = NULL;
 #endif
@@ -216,7 +210,7 @@ int main(int argc, char * argv[]) {
     }
 #if (CSP_HAVE_LIBSOCKETCAN)
     if (can_device) {
-        int error = csp_can_socketcan_open_and_add_interface(can_device, CSP_IF_CAN_DEFAULT_NAME, 0, false, &default_iface);
+        int error = csp_can_socketcan_open_and_add_interface(can_device, CSP_IF_CAN_DEFAULT_NAME, address, false, &default_iface);
         if (error != CSP_ERR_NONE) {
             csp_print("failed to add CAN interface [%s], error: %d\n", can_device, error);
             exit(1);
@@ -225,7 +219,7 @@ int main(int argc, char * argv[]) {
 #endif
 #if (CSP_HAVE_LIBZMQ)
     if (zmq_device) {
-        int error = csp_zmqhub_init(0, zmq_device, 0, &default_iface);
+        int error = csp_zmqhub_init(address, zmq_device, 0, &default_iface);
         if (error != CSP_ERR_NONE) {
             csp_print("failed to add ZMQ interface [%s], error: %d\n", zmq_device, error);
             exit(1);
